<% content_for :meta_title, "Dashboard - #{DEFAULT_META["meta_product_name"]}" %>
<div class="container">
  <div class="static-container">
    <% unless current_user %>

      <div class="col-md-8 m-auto text-center">
        <h3 class="my-5">Please log in to be able to access your dashboard!</h3>
        <%= link_to "Log in", new_user_session_path, class: "btn-pib" %>
      </div>

    <% else %>

      <ul class="nav nav-tabs pt-3" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="kita-contact-tab" data-toggle="tab" href="#kita-contact" role="tab" aria-controls="kita-contact" aria-selected="true">Contacts to kita</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="reminders-tab" data-toggle="tab" href="#reminders" role="tab" aria-controls="reminders" aria-selected="false">Reminders</a>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="kita-contact" role="tabpanel" aria-labelledby="kita-contact-tab">
          <h1>All my kita contacts</h1>

          <% if @kitas.empty? %>

            <p class="pt-5 text-center"><i>You don't have any kita details for the moment. Check our Kita Finder to help you locate your ideal kita!</i></p>

            <%= link_to "Go to Kita Finder", kita_finder_path, class:"btn-pib-dark d-block mx-auto text-center", style:"width: 160px;" %>

          <% else %>
            <div
              id="map"
              class="kita-contacts-map"
              data-markers="<%= @markers.to_json %>"
              data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
            ></div>

            <% @kitas.each do |k| %>
              <div class="my-4">
                <h3><%= link_to k.name, kindergarten_path(k), class: "pib-text-link" %></h3>
                <% k.kita_contacts.where(user: current_user).order(created_at: :desc).each do |kc| %>
                  <div class="kita-contacts d-flex">
                    <div class="kita-contacts-item col-sm-1 text-center">
                      <% if kc.contact_type == "call" %>
                        <i class="fas fa-phone"></i>
                      <% elsif kc.contact_type == "email" %>
                        <i class="fas fa-at"></i>
                      <% elsif kc.contact_type == "visit" %>
                        <i class="fas fa-walking"></i>
                      <% elsif kc.contact_type == "other" %>
                        <i class="fas fa-th-list"></i>
                      <% end %>
                    </div>
                    <div class="kita-contacts-item col-sm-2">
                      <%= kc.created_at.strftime("%a %e %B - %H:%M") %>
                    </div>
                    <div class="kita-contacts-item col-sm-9">
                      <%= kc.note %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>

          <% end %>


        </div>

        <div class="tab-pane fade" id="reminders" role="tabpanel" aria-labelledby="reminders-tab">
          <i>Please be patient, we are still working on this feature :)</i>
        </div>
      </div>


    <% end %>
  </div>
</div>
